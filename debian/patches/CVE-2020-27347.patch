From a868bacb46e3c900530bed47a1c6f85b0fbe701c Mon Sep 17 00:00:00 2001
From: nicm <nicm>
Date: Thu, 29 Oct 2020 16:33:01 +0000
Subject: [PATCH] Do not write after the end of the array and overwrite the
 stack when colon-separated SGR sequences contain empty arguments. Reported by
 Sergey Nizovtsev.

---
 input.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: tmux-3.0a/input.c
===================================================================
--- tmux-3.0a.orig/input.c
+++ tmux-3.0a/input.c
@@ -1911,8 +1911,13 @@ input_csi_dispatch_sgr_colon(struct inpu
 				free(copy);
 				return;
 			}
-		} else
+		} else {
 			n++;
+			if (n == nitems(p)) {
+				free(copy);
+				return;
+			}
+		}
 		log_debug("%s: %u = %d", __func__, n - 1, p[n - 1]);
 	}
 	free(copy);
